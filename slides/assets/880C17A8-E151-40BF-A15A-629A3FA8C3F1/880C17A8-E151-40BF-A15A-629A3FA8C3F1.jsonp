local_slide( {"name":"880C17A8-E151-40BF-A15A-629A3FA8C3F1","json":{"assets":{"5CE0E4CA5676117E2732C49F47E21967":{"type":"texture","index":0,"assetRequest":{"type":"slide","state":"contents","slide":"none"},"url":{"native":"assets\/880C17A8-E151-40BF-A15A-629A3FA8C3F1.pdf"},"width":1920,"height":1080},"032CEE94F1CA0E974FF7CC94944601A7":{"type":"texture","index":1,"assetRequest":{"type":"slide","state":"contents","slide":"none"},"url":{"native":"assets\/880C17A8-E151-40BF-A15A-629A3FA8C3F1.pdf"},"width":1920,"height":1080}},"events":[{"effects":[{"beginTime":0,"baseLayer":{"animations":[],"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":251658240,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"objectID":"0","layers":[{"animations":[],"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,-0.00035007912466775983,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":251658240,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"layers":[{"animations":[],"layers":[],"texturedRectangle":{"isBackgroundTexture":false,"singleTextureOpacity":1,"textureType":0,"textBaseline":0,"textXHeight":0,"isVerticalText":false},"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":0,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"texture":"032CEE94F1CA0E974FF7CC94944601A7"},{"animations":[{"timeOffset":0,"from":{"scalar":false},"beginTime":0,"repeatCount":0,"fillMode":"both","property":"hidden","autoreverses":false,"duration":0.01,"to":{"scalar":true}}],"layers":[],"texturedRectangle":{"isBackgroundTexture":false,"singleTextureOpacity":1,"textureType":0,"textBaseline":0,"textXHeight":0,"isVerticalText":false},"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":0,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"texture":"5CE0E4CA5676117E2732C49F47E21967"}]}]},"effects":[],"duration":0.01,"type":"transition","attributes":{"direction":0},"name":"none","objectID":"0"}],"automaticPlay":false,"hyperlinks":[],"accessibility":[{"text":";Handlers","targetRectangle":{"y":47.913688659667969,"x":243.05955505371094,"width":151.716796875,"height":33}},{"text":"(defn echo-handler [request]","targetRectangle":{"y":80.913688659667969,"x":243.05955505371094,"width":472.0078125,"height":33}},{"text":"  (ok (with-out-str (pp\/pprint request))))","targetRectangle":{"y":113.91368865966797,"x":243.05955505371094,"width":708.01171875,"height":33}},{"text":"(defn weapons-query-handler [{{:strs [name]} :params :keys [conn] :as request}]","targetRectangle":{"y":179.91368865966797,"x":243.05955505371094,"width":1331.736328125,"height":33}},{"text":"  (ok","targetRectangle":{"y":212.91368865966797,"x":243.05955505371094,"width":84.287109375,"height":33}},{"text":"    (if name","targetRectangle":{"y":245.91368865966797,"x":243.05955505371094,"width":202.2890625,"height":33}},{"text":"      (w\/weapons @conn [name])","targetRectangle":{"y":278.91368865966797,"x":243.05955505371094,"width":505.72265625,"height":33}},{"text":"      (w\/everybodys-weapons @conn))))","targetRectangle":{"y":311.91368865966797,"x":243.05955505371094,"width":623.724609375,"height":33}},{"text":"(defn add-weapons-handler [{:keys [params conn] :as request}]","targetRectangle":{"y":377.91368865966797,"x":243.05955505371094,"width":1028.302734375,"height":33}},{"text":"  (let [data (map (fn [[k v]] {:name k :weapon v}) params)]","targetRectangle":{"y":410.91368865966797,"x":243.05955505371094,"width":994.587890625,"height":33}},{"text":"    (do","targetRectangle":{"y":443.91368865966797,"x":243.05955505371094,"width":118.001953125,"height":33}},{"text":"      (d\/transact! conn data)","targetRectangle":{"y":476.91368865966797,"x":243.05955505371094,"width":488.865234375,"height":33}},{"text":"      (ok (w\/weapons @conn (keys params))))))","targetRectangle":{"y":509.91368865966797,"x":243.05955505371094,"width":758.583984375,"height":33}},{"text":"(defn files-handler [{:keys [sql-conn]}]","targetRectangle":{"y":575.91368865966797,"x":243.05955505371094,"width":674.296875,"height":33}},{"text":"  (ok (f\/all-processed-files sql-conn)))","targetRectangle":{"y":608.91368865966797,"x":243.05955505371094,"width":674.296875,"height":33}},{"text":";Routes - All data","targetRectangle":{"y":674.91368865966797,"x":243.05955505371094,"width":303.43359375,"height":33}},{"text":"(def basic-routes","targetRectangle":{"y":707.91368865966797,"x":243.05955505371094,"width":286.576171875,"height":33}},{"text":"  [[\\\"\/echo\\\" {:get echo-handler}]","targetRectangle":{"y":740.91368865966797,"x":243.05955505371094,"width":539.4375,"height":33}},{"text":"   [\\\"\/files\\\" {:get files-handler}]])","targetRectangle":{"y":773.91368865966797,"x":243.05955505371094,"width":606.8671875,"height":33}},{"text":"(def weapons-routes","targetRectangle":{"y":839.91368865966797,"x":243.05955505371094,"width":320.291015625,"height":33}},{"text":"  [[\\\"\/weapons\\\" weapons-query-handler]","targetRectangle":{"y":872.91368865966797,"x":243.05955505371094,"width":623.724609375,"height":33}},{"text":"   [\\\"\/add_weapon\\\" add-weapons-handler]])","targetRectangle":{"y":905.91368865966797,"x":243.05955505371094,"width":674.296875,"height":33}},{"text":";Router","targetRectangle":{"y":971.91368865966797,"x":243.05955505371094,"width":118.001953125,"height":33}},{"text":"(def router","targetRectangle":{"y":1004.913688659668,"x":243.05955505371094,"width":185.431640625,"height":33}},{"text":"  (ring\/router","targetRectangle":{"y":1037.913688659668,"x":243.05955505371094,"width":236.00390625,"height":33}},{"text":"    ;We were able to compose the routes here","targetRectangle":{"y":1070.913688659668,"x":243.05955505371094,"width":741.7265625,"height":33}},{"text":"    [basic-routes weapons-routes]","targetRectangle":{"y":1103.913688659668,"x":243.05955505371094,"width":556.294921875,"height":33}},{"text":"    {:data {:coercion   reitit.coercion.spec\/coercion","targetRectangle":{"y":1136.913688659668,"x":243.05955505371094,"width":893.443359375,"height":33}},{"text":"            :middleware [params\/wrap-params","targetRectangle":{"y":1169.913688659668,"x":243.05955505371094,"width":724.869140625,"height":33}},{"text":"                         middleware\/wrap-format]}}))","targetRectangle":{"y":1202.913688659668,"x":243.05955505371094,"width":876.5859375,"height":33}},{"text":";Global handler","targetRectangle":{"y":1268.913688659668,"x":243.05955505371094,"width":252.861328125,"height":33}},{"text":"(def handler","targetRectangle":{"y":1301.913688659668,"x":243.05955505371094,"width":202.2890625,"height":33}},{"text":"  (ring\/ring-handler","targetRectangle":{"y":1334.913688659668,"x":243.05955505371094,"width":337.1484375,"height":33}},{"text":"    router","targetRectangle":{"y":1367.913688659668,"x":243.05955505371094,"width":168.57421875,"height":33}},{"text":"    (constantly (not-found \\\"Not found\\\"))))","targetRectangle":{"y":1400.913688659668,"x":243.05955505371094,"width":708.01171875,"height":33}},{"text":"(defmethod ig\/init-key ::jdbc\/init [_ {:keys [conn]}]","targetRectangle":{"y":1466.913688659668,"x":243.05955505371094,"width":893.443359375,"height":33}},{"text":"  (f\/setup conn))","targetRectangle":{"y":1499.913688659668,"x":243.05955505371094,"width":286.576171875,"height":33}},{"text":"(defn line->record [line]","targetRectangle":{"y":1565.913688659668,"x":243.05955505371094,"width":421.435546875,"height":33}},{"text":"  (let [[name & weapons] (map cs\/trim (cs\/split line #\\\",\\\"))]","targetRectangle":{"y":1598.913688659668,"x":243.05955505371094,"width":1011.4453125,"height":33}},{"text":"    (cond-> {:name name}","targetRectangle":{"y":1631.913688659668,"x":243.05955505371094,"width":404.578125,"height":33}},{"text":"            (seq weapons)","targetRectangle":{"y":1664.913688659668,"x":243.05955505371094,"width":421.435546875,"height":33}},{"text":"            (assoc :weapon weapons))))","targetRectangle":{"y":1697.913688659668,"x":243.05955505371094,"width":640.58203125,"height":33}},{"text":"(defn file-handler [{:keys [queue conn] :as ctx} {:keys [^File file kind] :as event}]","targetRectangle":{"y":1763.913688659668,"x":243.05955505371094,"width":1432.880859375,"height":33}},{"text":"  (when (and (#{:modify :create} kind)","targetRectangle":{"y":1796.913688659668,"x":243.05955505371094,"width":640.58203125,"height":33}},{"text":"             (.exists file)","targetRectangle":{"y":1829.913688659668,"x":243.05955505371094,"width":455.150390625,"height":33}},{"text":"             (.isFile file)","targetRectangle":{"y":1862.913688659668,"x":243.05955505371094,"width":455.150390625,"height":33}},{"text":"             (cs\/ends-with? (.getName file) \\\".csv\\\"))","targetRectangle":{"y":1895.913688659668,"x":243.05955505371094,"width":876.5859375,"height":33}},{"text":"    (do","targetRectangle":{"y":1928.913688659668,"x":243.05955505371094,"width":118.001953125,"height":33}},{"text":"      (timbre\/debug (str \\\"Detected change to file: \\\" (.getName file)))","targetRectangle":{"y":1961.913688659668,"x":243.05955505371094,"width":1180.01953125,"height":33}},{"text":"      (with-open [r (io\/reader file)]","targetRectangle":{"y":1994.913688659668,"x":243.05955505371094,"width":623.724609375,"height":33}},{"text":"        (timbre\/debug \\\"Adding data to queue.\\\")","targetRectangle":{"y":2027.913688659668,"x":243.05955505371094,"width":775.44140625,"height":33}},{"text":"        (doseq [line (line-seq r)]","targetRectangle":{"y":2060.913688659668,"x":243.05955505371094,"width":573.15234375,"height":33}},{"text":"          (dq\/put! queue :my-queue line)))","targetRectangle":{"y":2093.913688659668,"x":243.05955505371094,"width":708.01171875,"height":33}},{"text":"      (f\/insert-file conn {:name (.getName file) :processed (Date.)})))","targetRectangle":{"y":2126.913688659668,"x":243.05955505371094,"width":1196.876953125,"height":33}},{"text":"  ctx)","targetRectangle":{"y":2159.913688659668,"x":243.05955505371094,"width":101.14453125,"height":33}},{"text":"(defn queue->dsdb [{:keys [queue-name queue dsdb]}]","targetRectangle":{"y":2225.913688659668,"x":243.05955505371094,"width":859.728515625,"height":33}},{"text":"  ;(timbre\/debug \\\"Checking for new items in queue...\\\")","targetRectangle":{"y":2258.913688659668,"x":243.05955505371094,"width":910.30078125,"height":33}},{"text":"  (when-some [task (dq\/take! queue queue-name 10 nil)]","targetRectangle":{"y":2291.913688659668,"x":243.05955505371094,"width":910.30078125,"height":33}},{"text":"    (do","targetRectangle":{"y":2324.913688659668,"x":243.05955505371094,"width":118.001953125,"height":33}},{"text":"      (timbre\/debug \\\"Putting data into datascript\\\")","targetRectangle":{"y":2357.913688659668,"x":243.05955505371094,"width":859.728515625,"height":33}},{"text":"      (d\/transact! dsdb [(line->record @task)])","targetRectangle":{"y":2390.913688659668,"x":243.05955505371094,"width":792.298828125,"height":33}},{"text":"      (dq\/complete! task))))","targetRectangle":{"y":2423.913688659668,"x":243.05955505371094,"width":472.0078125,"height":33}},{"text":"(def config","targetRectangle":{"y":2489.913688659668,"x":243.05955505371094,"width":185.431640625,"height":33}},{"text":"  {::jdbc\/connection       {:connection-uri \\\"jdbc:h2:mem:mem_only\\\"}","targetRectangle":{"y":2522.913688659668,"x":243.05955505371094,"width":1129.447265625,"height":33}},{"text":"   ::jdbc\/init             {:conn (ig\/ref ::jdbc\/connection)}","targetRectangle":{"y":2555.913688659668,"x":243.05955505371094,"width":1028.302734375,"height":33}},{"text":"   ::datascript\/connection w\/schema","targetRectangle":{"y":2588.913688659668,"x":243.05955505371094,"width":590.009765625,"height":33}},{"text":"   ::hawk\/watch            {:groups [{:paths   [\\\"example\\\"]","targetRectangle":{"y":2621.913688659668,"x":243.05955505371094,"width":977.73046875,"height":33}},{"text":"                                      :handler #'file-handler}]","targetRectangle":{"y":2654.913688659668,"x":243.05955505371094,"width":1062.017578125,"height":33}},{"text":"                            :queue  (ig\/ref ::durable\/queues)","targetRectangle":{"y":2687.913688659668,"x":243.05955505371094,"width":1028.302734375,"height":33}},{"text":"                            :conn   (ig\/ref ::jdbc\/connection)}","targetRectangle":{"y":2720.913688659668,"x":243.05955505371094,"width":1062.017578125,"height":33}},{"text":"   ::durable\/queues        {:delete-on-halt? true","targetRectangle":{"y":2753.913688659668,"x":243.05955505371094,"width":826.013671875,"height":33}},{"text":"                            :directory       \\\"\/tmp\\\"}","targetRectangle":{"y":2786.913688659668,"x":243.05955505371094,"width":876.5859375,"height":33}},{"text":"   ::scheduling\/job        {:job        #'queue->dsdb","targetRectangle":{"y":2819.913688659668,"x":243.05955505371094,"width":893.443359375,"height":33}},{"text":"                            :queue-name :my-queue","targetRectangle":{"y":2852.913688659668,"x":243.05955505371094,"width":826.013671875,"height":33}},{"text":"                            :schedule   {:in [5 :seconds] :every :second}","targetRectangle":{"y":2885.913688659668,"x":243.05955505371094,"width":1230.591796875,"height":33}},{"text":"                            :queue      (ig\/ref ::durable\/queues)","targetRectangle":{"y":2918.913688659668,"x":243.05955505371094,"width":1095.732421875,"height":33}},{"text":"                            :dsdb       (ig\/ref ::datascript\/connection)}","targetRectangle":{"y":2951.913688659668,"x":243.05955505371094,"width":1230.591796875,"height":33}},{"text":"   ::web\/server            {:host     \\\"0.0.0.0\\\"","targetRectangle":{"y":2984.913688659668,"x":243.05955505371094,"width":792.298828125,"height":33}},{"text":"                            :port     3000","targetRectangle":{"y":3017.913688659668,"x":243.05955505371094,"width":708.01171875,"height":33}},{"text":"                            :sql-conn (ig\/ref ::jdbc\/connection)","targetRectangle":{"y":3050.913688659668,"x":243.05955505371094,"width":1078.875,"height":33}},{"text":"                            :conn     (ig\/ref ::datascript\/connection)","targetRectangle":{"y":3083.913688659668,"x":243.05955505371094,"width":1180.01953125,"height":33}},{"text":"                            :handler  #'handler}})","targetRectangle":{"y":3116.913688659668,"x":243.05955505371094,"width":842.87109375,"height":33}},{"text":"(defonce sys (create config))","targetRectangle":{"y":3182.913688659668,"x":243.05955505371094,"width":488.865234375,"height":33}}],"baseLayer":{"animations":[],"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":251658240,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"objectID":"0","layers":[{"animations":[],"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,-0.00035007912466775983,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":251658240,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"layers":[{"animations":[],"layers":[],"texturedRectangle":{"isBackgroundTexture":false,"singleTextureOpacity":1,"textureType":0,"textBaseline":0,"textXHeight":0,"isVerticalText":false},"initialState":{"affineTransform":[1,0,0,1,0,0],"masksToBounds":false,"rotation":0,"scale":1,"position":{"pointX":960,"pointY":540},"width":1920,"sublayerTransform":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"contentsRect":{"y":0,"x":0,"width":1,"height":1},"opacity":1,"edgeAntialiasingMask":0,"height":1080,"hidden":false,"anchorPoint":{"pointX":0.5,"pointY":0.5}},"texture":"5CE0E4CA5676117E2732C49F47E21967"}]}]}}]}} )